<!DOCTYPE html>
<html>
<head>
    <title>Fix Admin Panel APIs</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #45a049;
        }
        #status {
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Fix Admin Panel API Display</h1>
    <p>This will clear your cached API endpoints and load all 13 APIs from the server.</p>
    
    <button onclick="clearAndReload()">üîÑ Clear Cache & Load from Server</button>
    <button onclick="viewCurrent()">üëÅÔ∏è View Current localStorage</button>
    <button onclick="goToAdmin()">üìä Go to Admin Panel</button>
    
    <div id="status"></div>
    <pre id="apiList"></pre>
    
    <script>
        async function clearAndReload() {
            const status = document.getElementById('status');
            status.className = 'info';
            status.innerHTML = 'üîÑ Clearing cache...';
            
            // Clear all API-related localStorage
            const keysToRemove = [];
            for (let key in localStorage) {
                if (key.includes('api') || key.includes('endpoint')) {
                    keysToRemove.push(key);
                }
            }
            
            keysToRemove.forEach(key => {
                console.log('Removing:', key);
                localStorage.removeItem(key);
            });
            
            status.innerHTML = 'üì° Loading from server...';
            
            try {
                // Load fresh data from server
                const response = await fetch('/api/endpoints');
                const config = await response.json();
                
                // Transform to admin panel format
                const apiEndpoints = config.endpoints.map((api, index) => ({
                    id: index + 1,
                    name: api.name || api.id,
                    method: api.method || 'GET',
                    url: api.url,
                    headers: api.headers || {},
                    description: api.description,
                    endpoint_key: api.id,
                    active: api.active !== false,
                    body_template: api.body_template,
                    params: api.params,
                    params_required: api.params_required
                }));
                
                // Save to localStorage
                localStorage.setItem('apiEndpoints', JSON.stringify(apiEndpoints));
                
                status.className = 'success';
                status.innerHTML = `‚úÖ Loaded ${apiEndpoints.length} APIs from server!`;
                
                // Display the APIs
                document.getElementById('apiList').textContent = JSON.stringify(apiEndpoints, null, 2);
                
            } catch (error) {
                status.className = 'error';
                status.innerHTML = '‚ùå Error: ' + error.message;
            }
        }
        
        function viewCurrent() {
            const current = localStorage.getItem('apiEndpoints');
            const apiList = document.getElementById('apiList');
            
            if (current) {
                try {
                    const parsed = JSON.parse(current);
                    apiList.textContent = `Found ${parsed.length} APIs in localStorage:\n\n` + JSON.stringify(parsed, null, 2);
                } catch (e) {
                    apiList.textContent = 'Error parsing localStorage: ' + e.message;
                }
            } else {
                apiList.textContent = 'No API endpoints found in localStorage';
            }
        }
        
        function goToAdmin() {
            window.location.href = '/admin.html';
        }
        
        // Load current state on page load
        viewCurrent();
    </script>
</body>
</html>